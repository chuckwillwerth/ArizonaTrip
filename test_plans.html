<!DOCTYPE html>
<html>
<head>
  <title>Test Multiple Plans</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button { padding: 10px; margin: 5px; }
    .output { background: #f0f0f0; padding: 10px; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>Test Multiple Plans Storage</h1>
  
  <button onclick="testCreatePlan()">Create New Plan</button>
  <button onclick="testSwitchPlan()">Switch Plan</button>
  <button onclick="testListPlans()">List All Plans</button>
  <button onclick="testClearStorage()">Clear Storage</button>
  
  <div id="output" class="output"></div>
  
  <script>
    // Copy the relevant code from map.js for testing
    const TRIP_DAYS = [
      { num: 1, date: 'Feb 14', label: 'Sat' },
      { num: 2, date: 'Feb 15', label: 'Sun' },
      { num: 3, date: 'Feb 16', label: 'Mon' },
      { num: 4, date: 'Feb 17', label: 'Tue' },
      { num: 5, date: 'Feb 18', label: 'Wed' },
      { num: 6, date: 'Feb 19', label: 'Thu' },
      { num: 7, date: 'Feb 20', label: 'Fri' }
    ];
    
    let plannerState = { activeDay: 1, days: {} };
    TRIP_DAYS.forEach(d => { plannerState.days[d.num] = { start: null, end: null, stops: [] }; });
    
    let allPlans = {};
    let currentPlanId = 'default';
    
    function createEmptyPlan() {
      const emptyPlan = { activeDay: 1, days: {} };
      TRIP_DAYS.forEach(d => { emptyPlan.days[d.num] = { start: null, end: null, stops: [] }; });
      return emptyPlan;
    }
    
    function loadAllPlans() {
      try {
        const saved = localStorage.getItem('arizonaTripPlans');
        if (saved) {
          allPlans = JSON.parse(saved);
        } else {
          const oldPlan = localStorage.getItem('arizonaTripPlanner');
          if (oldPlan) {
            const parsed = JSON.parse(oldPlan);
            allPlans = {
              'default': { name: 'Default Plan', data: parsed }
            };
            saveAllPlans();
            localStorage.removeItem('arizonaTripPlanner');
          } else {
            allPlans = {
              'default': { name: 'Default Plan', data: createEmptyPlan() }
            };
          }
        }
        
        const savedCurrentId = localStorage.getItem('arizonaTripCurrentPlan');
        if (savedCurrentId && allPlans[savedCurrentId]) {
          currentPlanId = savedCurrentId;
        }
        
        if (allPlans[currentPlanId]) {
          plannerState = allPlans[currentPlanId].data;
          if (!plannerState.activeDay) plannerState.activeDay = 1;
        }
      } catch (e) { 
        log('Error loading plans: ' + e.message);
      }
    }
    
    function saveAllPlans() {
      try {
        localStorage.setItem('arizonaTripPlans', JSON.stringify(allPlans));
      } catch (e) { 
        log('Error saving plans: ' + e.message);
      }
    }
    
    function switchPlan(planId) {
      if (!allPlans[planId]) {
        log('Plan not found: ' + planId);
        return;
      }
      
      if (allPlans[currentPlanId]) {
        allPlans[currentPlanId].data = plannerState;
      }
      
      currentPlanId = planId;
      plannerState = JSON.parse(JSON.stringify(allPlans[planId].data));
      if (!plannerState.activeDay) plannerState.activeDay = 1;
      
      localStorage.setItem('arizonaTripCurrentPlan', currentPlanId);
      saveAllPlans();
      
      log('Switched to: ' + allPlans[planId].name);
    }
    
    function log(msg) {
      const output = document.getElementById('output');
      output.innerHTML += msg + '<br>';
    }
    
    // Initialize
    loadAllPlans();
    log('Initialized. Current plan: ' + allPlans[currentPlanId].name);
    
    // Test functions
    function testCreatePlan() {
      const planId = 'plan_' + Date.now();
      const name = 'Test Plan ' + Math.floor(Math.random() * 100);
      
      allPlans[planId] = {
        name: name,
        data: createEmptyPlan()
      };
      
      saveAllPlans();
      log('‚úÖ Created plan: ' + name + ' (ID: ' + planId + ')');
    }
    
    function testSwitchPlan() {
      const planIds = Object.keys(allPlans);
      if (planIds.length > 1) {
        const nextIndex = (planIds.indexOf(currentPlanId) + 1) % planIds.length;
        switchPlan(planIds[nextIndex]);
      } else {
        log('‚ö†Ô∏è Only one plan exists. Create more plans first.');
      }
    }
    
    function testListPlans() {
      log('--- All Plans ---');
      Object.keys(allPlans).forEach(planId => {
        const plan = allPlans[planId];
        const isCurrent = planId === currentPlanId ? ' (CURRENT)' : '';
        log(`‚Ä¢ ${plan.name}${isCurrent} - ID: ${planId}`);
      });
      log('----------------');
    }
    
    function testClearStorage() {
      if (confirm('Clear all plans from localStorage?')) {
        localStorage.removeItem('arizonaTripPlans');
        localStorage.removeItem('arizonaTripCurrentPlan');
        allPlans = {
          'default': { name: 'Default Plan', data: createEmptyPlan() }
        };
        currentPlanId = 'default';
        plannerState = allPlans[currentPlanId].data;
        log('üóëÔ∏è Storage cleared. Reloading...');
        location.reload();
      }
    }
  </script>
</body>
</html>
